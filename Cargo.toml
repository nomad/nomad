[workspace]
resolver = "2"
members = ["crates/*", "lib/*", "lib/nvimx2/*", "xtask"]
exclude = ["lib/nvimx2/src"]

[workspace.package]
version = "0.1.0"
edition = "2024"
authors = ["Nomad <hello@nomad.foo>"]
license = "MIT"
publish = false

[workspace.dependencies]
async-fs = "2"
async-net = "2"
compact_str = "0.8"
eerie = { git = "ssh://git@github.com/nomad/eerie.git" }
flume = { version = "0.11", features = ["async"] }
futures = "0.3"
futures-util = "0.3"
fxhash = "0.2"
nohash = "0.2"
nvim-oxi = { git = "https://github.com/noib3/nvim-oxi" }
pin-project-lite = "0.2"
quickcheck = "1"
quickcheck_macros = "1"
serde = "1.0"
smallvec = "1.13"
smol_str = "0.3"
thiserror = "2.0"
tracing = "0.1"

nvimx = { path = "./lib/nvimx" }
nvimx2 = { path = "./lib/nvimx2" }
nvimx-common = { path = "./lib/nvimx/nvimx-common" }
nvimx-ctx = { path = "./lib/nvimx/nvimx-ctx" }
nvimx-diagnostics = { path = "./lib/nvimx/nvimx-diagnostics" }
nvimx-emit = { path = "./lib/nvimx/nvimx-emit" }
nvimx-event = { path = "./lib/nvimx/nvimx-event" }
nvimx-executor = { path = "./lib/nvimx/nvimx-executor" }
nvimx-fs = { path = "./lib/nvimx/nvimx-fs" }
nvimx-macros = { path = "./lib/nvimx/nvimx-macros" }
nvimx-plugin = { path = "./lib/nvimx/nvimx-plugin" }
nvimx-ui = { path = "./lib/nvimx/nvimx-ui" }

auth = { path = "./crates/auth" }
clipboard = { path = "./crates/clipboard" }
collab = { path = "./crates/collab" }
collab2 = { path = "./crates/collab2" }
editor = { path = "./crates/editor" }
editor-mock = { path = "./crates/editor-mock" }
editor-neovim = { path = "./crates/editor-neovim" }
nomad = { path = "./crates/nomad" }
root-finder = { path = "./crates/root-finder" }
version = { path = "./crates/version" }

[workspace.lints.clippy]
bool_to_int_with_if = "deny"
cognitive_complexity = "deny"
module_inception = "allow"
# multiple_crate_versions = "deny" TODO: re-enable
needless_collect = "deny"
same_name_method = "deny"
too_many_arguments = "deny"
too_many_lines = "deny"
unwrap_used = "deny"

[workspace.lints.rust]
future_incompatible = { level = "deny", priority = -1 }
missing_docs = "deny"
nonstandard_style = { level = "deny", priority = -1 }
refining_impl_trait = { level = "allow", priority = -1 }

[workspace.lints.rustdoc]
broken_intra_doc_links = "deny"
private_intra_doc_links = "deny"

[package]
name = "nomad-neovim"
version.workspace = true
edition.workspace = true
authors.workspace = true

[lib]
crate-type = ["cdylib"]

[features]
neovim-nightly = ["nvimx2/neovim-nightly"]

[dependencies]
auth = { workspace = true }
collab = { workspace = true }
nvimx2 = { workspace = true, features = ["neovim-0-10"] }
version = { workspace = true }
